#!/usr/bin/env python3.4

import struct
import math

(lambda A,M,e,p,U,b,w,h:(lambda o,lt,S,X,D,nz,wv,F,P:(lambda z:(lambda b1: (lambda b2:(F(b'BM'+P('<QIIHHHH',w*h*3+26,26,12,w,h,1,24))and 0)or[F(P('BBB',wv(p[2]),wv(p[1]),wv(p[0])))for p in[(lambda y:(lambda s:(200,200,255)if not s else[M(r[2],abs(p(r[1],y)))for r in s if r[0]==min([r[0]for r in s])][0])(list(filter(None,[(lambda v1,v2,x,s:(lambda d:(d or None)and(lambda a,b,c:((a>=0 and b>=0 and a+b<=1 and c<=0)or None)and(-c,nz(X(v1,v2)),t[3]))(s(x,v2,y)/d,s(v1,x,y)/d,s(v1, v2,x)/d))(s(v1,v2,y)))(D(t[1],t[0]),D(t[2],t[0]),(D(o,t[0])),lambda a,b,c:(a[0]*(b[1]*c[2]-c[1]*b[2])-b[0]*(a[1]*c[2]-c[1]*a[2])+c[0]*(a[1]*b[2]-b[1]*a[2])))for t in S]))))(nz(A(z,A(M(b1,(x-w/2)*10./w),M(b2,(y-h/2)*10/w)))))for y in range(h)for x in range(w)]])(nz(X(z,b1))))(e(0)if z==e(2)else nz(X(e(2),z))))(D(lt,o)))(U('<fff',b),U('fff',b,12),[(t[:3],t[3:6],t[6:9],t[9:])for t in struct.iter_unpack('fffffffffBBB',b[24:])],lambda a,b:(a[1]*b[2]-a[2]*b[1],a[2]*b[0]-a[0]*b[2],a[0]*b[1]-a[1]*b[0]),lambda a,b: A(a,(-b[0],-b[1],-b[2])),lambda a:M(a,1/math.sqrt(p(a,a)))if a!=e(3)else a,lambda x:min(max(int(x),0),255),open('S.bmp','wb').write,struct.pack))(lambda a,b:(a[0]+b[0],a[1]+b[1],a[2]+b[2]),lambda a,v:(a[0]*v,a[1]*v,a[2]*v),lambda i:(+(i==0),+(i==1),+(i==2)),lambda a,b:a[0]*b[0]+a[1]*b[1]+a[2]*b[2],struct.unpack_from,open('S.bin','rb').read(),800,600)
